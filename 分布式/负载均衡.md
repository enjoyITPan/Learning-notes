## 负责均衡方案

### DNS域名解析负载均衡

 原理：在DNS服务器上配置多个域名对应IP的记录。例如一个域名www.baidu.com对应一组web服务器IP地址，域名解析时经过DNS服务器的算法将一个域名请求分配到合适的真实服务器上。

 ***优点：***将负载均衡的工作交给了DNS，省却了网站管理维护负载均衡服务器的麻烦，同事许多DNS还支持基于地理位置的域名解析，将域名解析成距离用户地理最近的一个服务器地址，加快访问速度吗，改善性能。

 ***缺点：***目前的DNS解析是多级解析，每一级DNS都可能化缓存记录A，当摸一服务器下线后，该服务器对应的DNS记录A可能仍然存在，导致分配到该服务器的用户访问失败。

 DNS负载均衡的控制权在域名服务商手里，网站可能无法做出过多的改善和管理。

 不能够按服务器的处理能力来分配负载。DNS负载均衡采用的是简单的轮询算法，不能区分服务器之间的差异，不能反映服务器当前运行状态，所以其的负载均衡效果并不是太好。

 可能会造成额外的网络问题。为了使本DNS服务器和其他DNS服务器及时交互，保证DNS数据及时更新，使地址能随机分配，一般都要将DNS的刷新时间设置的较小，但太小将会使DNS流量大增造成额外的网络问题。

### 反向代理负载均衡

 原理：反向代理处于web服务器这边，反向代理服务器提供负载均衡的功能，同时管理一组web服务器，它根据负载均衡算法将请求的浏览器访问转发到不同的web服务器处理，处理结果经过反向服务器返回给浏览器。

 例如：浏览器访问请求的地址是反向代理服务器的地址114.100.80.10，反向代理服务器收到请求，经过负载均衡算法后得到一个真实物理地址10.0.03，并将请求结果发给真实服务，真实服务器处理完后通过反向代理服务器返回给请求用户。

 优点：部署简单，处于http协议层面。

 缺点：使用了反向代理服务器后，web 服务器地址不能直接暴露在外，因此web服务器不需要使用外部IP地址，而反向代理服务作为沟通桥梁就需要配置双网卡、外部内部两套IP地址。

## 负载均衡策略

### 轮询(Round Robin)

轮询是一种很简单的实现，依次将请求分配给后端服务器。优点就是实现简单，请求均匀分配。
 缺点也恰恰在于请求均匀分配，因为后端服务器通常性能会有差异，所以希望性能好的服务器能够多承担一部分。也不适合对长连接和命中率有要求的场景。

### 加权轮询(Weighted Round Robin)

加权本质是一种带优先级的方式，加权轮询就是一种改进的轮询算法，轮询算法是权值相同的加权轮询。需要给后端每个服务器设置不同的权值，决定分配的请求数比例。这个算法应用就相当广泛了，对于无状态的负载场景，非常适合。
 优点解决了服务器性能不一的情况，缺点是权值需要静态配置，无法自动调节。也不适合对长连接和命中率有要求的场景。

### 随机Random

随机把请求分配给后端服务器。请求分配的均匀程度依赖于随机算法了，因为实现简单，常常用于配合处理一些极端的情况，如出现热点请求，这个时候就可以random到任意一台后端，以分散热点。当然缺点也不言而喻。

### ip hash\url hash

通过循环或最少连接的负载平衡，每个后续客户端的请求都可能分配到其他服务器。 无法保证将同一客户端始终定向到同一服务器。

如果需要将客户端绑定到特定的应用程序服务器（换句话说，就始终尝试选择特定服务器而言，使客户端的会话为``粘性''或``持久性''）-ip-hash负载平衡机制可以是 用过的。

使用ip-hash，客户端的IP地址用作哈希密钥，以确定应为客户端的请求选择服务器组中的哪个服务器。 此方法可确保将来自同一客户端的请求始终定向到同一服务器，除非该服务器不可用。

